<!DOCTYPE html>
<html>

<head>
    <style>
        /* The Modal (background) */
        .modal {
            display: none;
            /* Hidden by default */
            position: fixed;
            /* Stay in place */
            z-index: 1;
            /* Sit on top */
            width: auto;
            right: 0;
            top: 0;
            padding: 120px;

            overflow: auto;
            text-align: center;
            /* Enable scroll if needed */
            background-color: rgb(0, 0, 0);
            /* Fallback color */
            background-color: rgba(0, 0, 0, 0.4);
            /* Black w/ opacity */

        }

        /* Modal Content/Box */
        .modal-content {
            background-color: #fefefe;
            margin: 48px auto;
            /* 15% from the top and centered */
            padding: 20px;
            border: 1px solid #888;
            text-align: center;
            width: 80%;
            /* Could be more or less, depending on screen size */
        }

        /* The Close Button */
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }




        table {
            font-family: arial, sans-serif;
            border-collapse: collapse;
            width: 100%;
            border-radius: 10px;
        }

        td,
        th {
            border: 1px solid #dddddd;
            text-align: left;
            padding: 8px;
        }

        tr:nth-child(even) {
            background-color: #dddddd;
        }

        .ali {
            text-align: center;
        }

        .modal {
            display: none;
            /* Hidden by default */
            position: fixed;
            /* Stay in place */
            z-index: 1;
            /* Sit on top */
            padding-top: 100px;
            /* Location of the box */
            left: 0;
            top: 0;
            width: 100%;
            /* Full width */
            height: 100%;
            /* Full height */
            overflow: auto;
            /* Enable scroll if needed */
            background-color: rgb(0, 0, 0);
            /* Fallback color */
            background-color: rgba(0, 0, 0, 0.4);
            /* Black w/ opacity */
        }

        /* Modal Content */
        .modal-content {
            position: relative;
            background-color: #fefefe;
            margin: auto;
            padding: 0;
            border: 1px solid #888;
            width: 40%;
            box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
            -webkit-animation-name: animatetop;
            -webkit-animation-duration: 0.4s;
            animation-name: animatetop;
            animation-duration: 0.4s
        }

        /* Add Animation */
        @-webkit-keyframes animatetop {
            from {
                top: -300px;
                opacity: 0
            }

            to {
                top: 0;
                opacity: 1
            }
        }

        @keyframes animatetop {
            from {
                top: -300px;
                opacity: 0
            }

            to {
                top: 0;
                opacity: 1
            }
        }

        /* The Close Button */
        .close {
            color: white;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus,
        .Button:hover,
        .Button:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }

        .modal-header {
            padding: 2px 16px;
            background-color: #5cb85c;
            color: white;
        }

        .modal-body {
            padding: 2px 16px;
            vertical-align: middle;

        }

        .inputField {
            display: flex;
            margin: 10px;
        }

        .ratio {
            width: 65%
        }

        .input {
            border: 1px solid #ccc;
            border-radius: 5px;
            margin: 8px 8px 0px 8px;
            padding: 10px;
            width: 85%;



        }

        .inputLabel {
            margin: 20px;
            font-weight: 500;
            font-size: larger;
            width: 35%;
            text-align: left;
        }

        .modal-footer {
            padding: 2px 16px;
            background-color: #5cb85c;
            color: white;
        }

        .Button {
            margin: 0px 10px;
            padding: 10px;
            width: 80px;
            border-radius: 5px;
            border: #567970 1px solid;
            background: white;

            font-weight: 600;
            cursor: pointer;
        }

        .error {
            color: red;
            margin: 0px;
            text-align: left;
            margin-left: 12px;
        }
    </style>

</head>


<!--including a bootsrap css file!-->
<link href="css/bootstrap.min.css" rel="stylesheet">
<h1 class="ali">Data Table</h1>
<table id="table" class="table table-striped table-bordered table-hover table-condensed">
    <tr>
        <th>Id</th>
        <th>firstName</th>
        <th>lastName</th>
        <th>dateOfBirth</th>
        <th>Email</th>
        <th>termsAndCondition</th>
    </tr>
</table>

<!-- The Toast -->
<div id="myOfCanvas" class="offcanvas offcanvas-start ">

    <div class="offcanvas-header">
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
        <h2>Edit user</h2>
    </div>
    <div class="offcanvas-body">
        <div class="inputField">
            <label id="fnamelabel" class="inputLabel">FirstName:</label>
            <div class="ratio">
                <input type="text" id="fname" name="fname" class="form-control" onkeyup="clearError('fname')">
                <p class="error" id="fnameError"></p>
            </div>
        </div>
        <div class="inputField">
            <label id="lnamelabel" class="inputLabel">LastName:</label>
            <div class="ratio">
                <input type="text" id="lname" name="lname" class="form-control" onkeyup="clearError('lname')">
                <p class="error" id="lnameError"></p>
            </div>
        </div>
        <div class="inputField">
            <label id="DOBlabel" class="inputLabel">DateOfBirth:</label>
            <div class="ratio">
                <input type="date" id="dateOfBirth" name="dateOfBirth" class="form-control">
            </div>
        </div>
        <div class="inputField">
            <label id="emaillabel" class="inputLabel">Email:</label>
            <div class="ratio">
                <input type="text" id="email" name="email" readonly class="input">

            </div>
        </div>

    </div>
    <div class="offcanvas-footer">
        <button class="btn btn-success" type="button" id="save" onclick="offCanvas()"
            data-bs-toggle="offcanvas">Save</button>
        <button class="btn btn-primary " data-bs-dismiss=" offCanvas" type="button" id="cancel">Cancel</button>
    </div>

</div>
<!--Adding Java script bootstrap  -->
<script src="js/popper.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script>
    let sessionKey = sessionStorage.getItem("userDetails")
    if (!sessionKey) {
        window.location.href = "login.html"
    }
    else {

    }


    // Get the modal        
    var offCanvas = document.getElementById("myOfCanvas");

    // Fetch API to get user data
    fetch('http://localhost:3000/users')
        .then(response => response.json())
        .then(names => {
            const table = document.getElementById('table');

            names.forEach(name => {
                const row = document.createElement('tr');
                row.innerHTML = `
                        <td>${name.ID}</td>
                        <td>${name.firstName}</td>
                        <td>${name.lastName}</td>
                        <td>${name.dateOfBirth}</td>
                        <td>${name.email}</td>
                        <td>${name.termsAndConditions}</td>
                    `;

                // Append event listener to each row for modal
                row.addEventListener('click', () => {
                    debugger;
                    offCanvas.show();
                    document.getElementById('fname').value = name.firstName;
                    document.getElementById('lname').value = name.lastName;
                    document.getElementById('dateOfBirth').value = name.dateOfBirth;
                    document.getElementById('email').value = name.email;

                });

                table.appendChild(row);
            });
        })
        .catch(error => console.error('Fetch error:', error));



    window.addEventListener('click', () => {
        offCanvas.style.left = '0';
    });


    // cancel.onclick = function () {
    //     toast.style.display = "none";
    // }

    window.onclick = function (event) {
        if (event.target == offCanvas) {
            offCanvas.disabled = false;
        }
    }





    function offCanvas() {

        let fnamelabel = document.getElementById("fnamelabel");
        let fnameError = document.getElementById("fnameError");
        let lnameError = document.getElementById("lnameError");
        let lnamelabel = document.getElementById("lnamelabel");
        var firstName = document.getElementById('fname').value;
        var lastName = document.getElementById('lname').value;
        var dateOfBirth = document.getElementById('dateOfBirth').value;
        var email = document.getElementById('email').value;


        firstName = firstName.trim();
        lastName = lastName.trim();

        if (firstName === "" || lastName === "") {
            if (firstName === "") {
                fnameError.textContent = "First name required";
                fnamelabel.style.marginBottom = "16px";

            }
            if (lastName === "") {
                lnameError.textContent = "Last name required";
                lnamelabel.style.marginBottom = "16px";

            }


        }
        else {
            if (!validateDOB(dateOfBirth)) {

            }


            var editedDetails = {
                "firstName": firstName,
                "lastName": lastName,
                "dateOfBirth": dateOfBirth,
                "email": email
            };


            const apiUrl = 'http://localhost:3000/users'
            fetch(apiUrl, {

                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',

                },
                body: JSON.stringify(editedDetails),
            })
                .then(response => {

                    if (!response.ok) {
                        throw new Error('network response problem');
                    }

                    window.location.href = "users.html";

                })
                .catch(error => {


                })
        }

    }

    var maxDate = addYearsToDate(new Date(), -10).toISOString().split('T')[0];
    document.getElementById("dateofbirth").setAttribute('max', maxDate);


    function addYearsToDate(date, years) {
        date.setFullYear(date.getFullYear() + years);
        return date;
    }
    function validateDOB(formDOB) {

        var maxDate = addYearsToDate(new Date(), -10);
        var dateofbirthError = document.getElementById("dateofbirthError");
        if (new Date(formDOB) > maxDate) {
            dateofbirthError.textContent = "Invalid date of birth";
            return false;
        }
        return true;
    }
    function clearError(fieldName, hasNoLabel = false) {
        ErrorField = document.getElementById(fieldName + "Error")
        ErrorField.textContent = "";
        // debugger;
        if (!hasNoLabel) {
            LabelField = document.getElementById(fieldName + "label")
            LabelField.style.marginBottom = "0px";
        }


    }
</script>
</body>

</html>